version = "3.7.17"

# Основные настройки
runner.dialect = scala3
maxColumn = 120
assumeStandardLibraryStripMargin = true
align.stripMargin = true

# Отступы
indent.main = 2
indent.significant = 2
indent.callSite = 2
indent.ctorSite = 2
indent.defnSite = 2
indent.caseSite = 5
indent.extendSite = 4
indent.withSiteRelativeToExtends = 2

# Выравнивание (ZIO стиль)
align.preset = most
align.multiline = true
align.openParenCallSite = false
align.openParenDefnSite = false
align.tokens = [
  {code = "=>", owner = Case}
  {code = "=", owner = "(Enumerator.Val|Defn.(Va(l|r)|Def|Type))"}
  {code = "%", owner = "Term.ApplyInfix"}
  {code = "%%", owner = "Term.ApplyInfix"}
  {code = "<-", owner = "Enumerator.Generator"}
  {code = "->", owner = "Term.ApplyInfix"}
  {code = "extends", owner = "Defn.(Class|Trait|Object)"}
  {code = "//", owner = ".*"}
  {code = "{", owner = "Template"}
  {code = "}", owner = "Template"}
]
align.arrowEnumeratorGenerator = true
align.tokenCategory = {
  Equals = Assign
  LeftArrow = Assign
}

# Переносы строк
newlines.topLevelStatementBlankLines = [
  {blanks = 1}
]
newlines.beforeCurlyLambdaParams = multilineWithCaseOnly
newlines.afterCurlyLambdaParams = squash
newlines.implicitParamListModifierPrefer = before
newlines.sometimesBeforeColonInMethodReturnType = false

# ZIO-специфичные настройки для цепочек
optIn.breakChainOnFirstMethodDot = true
includeCurlyBraceInSelectChains = true
includeNoParensInSelectChains = true

# Переписывание правил (ZIO стиль)
rewrite.rules = [
  RedundantBraces,
  RedundantParens,
  SortModifiers,
  PreferCurlyFors,
  Imports
]

rewrite.redundantBraces.stringInterpolation = true
rewrite.redundantBraces.generalExpressions = false
rewrite.redundantBraces.ifElseExpressions = false
rewrite.redundantBraces.methodBodies = false
rewrite.redundantBraces.includeUnitMethods = false
rewrite.redundantBraces.parensForOneLineApply = true

# Импорты (ZIO стиль)
rewrite.imports.sort = scalastyle
rewrite.imports.groups = [
  ["java\\..*"],
  ["scala\\..*"],
  ["zio\\..*"],
  [".*"]
]
rewrite.imports.contiguousGroups = no

rewrite.trailingCommas.style = multiple
rewrite.trailingCommas.allowFolding = true

# Скобки и пробелы
spaces.inImportCurlyBraces = false
spaces.beforeContextBoundColon = Never
spaces.afterTripleEquals = true
spaces.inByNameTypes = true
spaces.afterSymbolicDefs = true

# Docstrings
docstrings.style = Asterisk
docstrings.wrap = no
docstrings.oneline = keep
docstrings.blankFirstLine = yes

# Вертикальное выравнивание
verticalMultiline.atDefnSite = true
verticalMultiline.arityThreshold = 3
verticalMultiline.newlineAfterOpenParen = true

# Литералы
literals.long = Upper
literals.float = Lower
literals.double = Lower
literals.hexDigits = Upper

# Комментарии
comments.wrap = standalone
comments.wrapStandaloneSlcAsSlc = true

# Опциональные скобки (Scala 3)
runner.dialectOverride.allowSignificantIndentation = true
runner.dialectOverride.allowAsForImportRename = true
runner.dialectOverride.allowStarWildcardImport = true

# Производительность
runner.optimizer.forceConfigStyleOnOffset = 150
runner.optimizer.forceConfigStyleMinArgCount = 2

# XML
xmlLiterals.assumeFormatted = true

# Дополнительные настройки для ZIO
optIn.configStyleArguments = true
optIn.encloseClassicChains = true

danglingParentheses.preset = true
danglingParentheses.defnSite = true
danglingParentheses.callSite = true
danglingParentheses.exclude = []

# Файлы для исключения
project.excludeFilters = [
  "target/"
]

fileOverride {
  "glob:**/project/**" {
    runner.dialect = scala212
  }
  "glob:**/*.sbt" {
    runner.dialect = scala212
  }
  "glob:**/src/main/scala-2.13/**" {
    runner.dialect = scala213
  }
}